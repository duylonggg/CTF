import random
import time
from pwn import *

def get_random(length, t):
    alphabet = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"
    random.seed(int(t))  # seed with the given time
    s = ""
    for i in range(length):
        s += random.choice(alphabet)
    return s

def flag():
    with open('/flag.txt', 'r') as picoCTF:
        content = picoCTF.read()
        print(content)

# Bắt đầu vòng lặp để thử gửi token
for j in range(50):  # Chạy vòng lặp thử 50 lần
    p = remote("verbal-sleep.picoctf.net", 62101)
    token_length = 20

    # Cố gắng tìm đúng khoảng thời gian seed
    t = time.time() * 1000 - 2000 + 50 * j  # Điều chỉnh thời gian seed

    for k in range(50):  # Gửi các token với các giá trị seed khác nhau
        token = get_random(token_length, t + k)  # Sinh token với thời gian t + k
        print(f"{token}")
        p.sendline(token.encode())  # Gửi token vào server

    res = p.recvall()  # Nhận tất cả dữ liệu trả về từ server
    if b'picoCTF' in res:  # Kiểm tra xem có chứa flag trong kết quả không
        print(res.decode())
        break
